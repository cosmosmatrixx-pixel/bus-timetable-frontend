<!DOCTYPE html>
<html>
<head>
  <title>Bus Results</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<div class="container">

  <h2>ðŸšŒ Available Buses</h2>

  <div id="result">Loading...</div>

</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const from = params.get("from");
  const to = params.get("to");

const API = "https://bus-timetable-backend.onrender.com";

fetch(`${API}/search?from=${from}&to=${to}`)

    .then(res => res.json())
    .then(data => {
      let html = "";

      if (!data || data.length === 0) {
        html = "<p>No bus found.</p>";
        document.getElementById("result").innerHTML = html;
        return;
      }

      data.forEach(bus => {
       html += `
  <div class="result-card">
    <div class="result-header">
      ðŸšŒ ${bus.bus}

<button class="share-btn"
  title="Share on WhatsApp"
  onclick="shareRoute('${bus.bus}', '${from}', '${to}')">
  <i class="fab fa-whatsapp"></i>
</button>

    </div>
    <div class="station-list">
`;


        // bus.stations.forEach(s => {
        //   html += `
        //     <div class="station-item">
        //       <span class="station-name">${s.name}</span>
        //       <span class="station-time">${s.time}</span>
        //     </div>
        //   `;
        // });

        // new code in place of above only 
        const stations = bus.stations;
const first = stations[0];
const last = stations[stations.length - 1];
const middle = stations.slice(1, -1);

html += `
  <div class="station-item">
    <span class="station-name">${first.name}</span>
    <span class="station-time">${first.time}</span>
  </div>
`;

if (middle.length > 0) {
  html += `
    <div class="middle-stations" id="mid-${bus._id}">
  `;

  middle.forEach(s => {
    html += `
      <div class="station-item">
        <span class="station-name">${s.name}</span>
        <span class="station-time">${s.time}</span>
      </div>
    `;
  });

  html += `
    </div>

    <button class="toggle-btn"
      onclick="toggleStations('${bus._id}', this)">
      Show More âŒ„
    </button>
  `;
}

if (stations.length > 1) {
  html += `
    <div class="station-item">
      <span class="station-name">${last.name}</span>
      <span class="station-time">${last.time}</span>
    </div>
  `;
}


        html += `
            </div>
          </div>
        `;
      });

      document.getElementById("result").innerHTML = html;
    });




    function shareRoute(busName, from, to) {
  const siteLink = window.location.origin + "/index.html";
//   const siteLink = "https://yourdomain.com";


  const message =
    `ðŸšŒ *Bus Route*\n` +
    `Bus: ${busName}\n` +
    `From: ${from}\n` +
    `To: ${to}\n\n` +
    `ðŸ”— Check timetable here:\n${siteLink}`;

  const whatsappUrl =
    "https://wa.me/?text=" + encodeURIComponent(message);

  window.open(whatsappUrl, "_blank");
}

</script>


<script>
function toggleStations(id, btn) {
  const el = document.getElementById("mid-" + id);

  if (el.style.display === "block") {
    el.style.display = "none";
    btn.innerText = "Show More âŒ„";
  } else {
    el.style.display = "block";
    btn.innerText = "Hide â–²";
  }
}
</script>


</body>
</html>
